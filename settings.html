<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Surf Lime • Settings</title>
<style>
  :root{ --bg:#0b1320; --ink:#e8f1ff; --accent:#46e38a; }
  *{ box-sizing:border-box }
  body{ margin:0; background:#0b1320; color:var(--ink); font:16px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; }
  .wrap{ max-width:860px; margin:24px auto; padding:0 16px; }
  h1{ font-size:22px; margin:8px 0 16px }
  .grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap:16px; }
  .card{ background:#0f233caa; border:1px solid #ffffff22; border-radius:14px; padding:16px; backdrop-filter: blur(6px); }
  label{ display:block; font-weight:600; margin-bottom:6px }
  select, input[type="range"]{ width:100%; }
  .cta{
    display:inline-flex; align-items:center; justify-content:center;
    padding:14px 22px; border-radius:14px; border:1px solid #46e38a88;
    background: linear-gradient(180deg, #46e38a, #2fbf72);
    color:#0b1320; font-weight:800; text-transform:uppercase; letter-spacing:.3px;
    box-shadow: 0 8px 24px rgba(70,227,138,.25);
    cursor:pointer; text-decoration:none; min-width:160px;
  }
  .cta:active{ transform: translateY(1px) }
  .row{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
  a.back{ color:#9cc; text-decoration:none; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <a class="back" href="index.html">← Back</a>
      <button id="btnPlay" class="cta">Play</button>
    </div>

    <h1>Settings</h1>

    <div class="grid">
      <div class="card">
        <label for="songSelect">Background Music</label>
        <select id="songSelect"></select>
        <small id="songHint"></small>
      </div>

      <div class="card">
        <label for="mascotScale">Mascot Scale</label>
        <input id="mascotScale" type="range" min="0.5" max="1.6" step="0.01">
        <small>Desktop base scale. Mobile can shrink further via <code>mobile.scaleDownPercent.mascot</code>.</small>
      </div>
    </div>
  </div>

  <script src="config.js"></script>
  <script>
  (function(){
    const CFG = window.SURFLIME_CONFIG || {};
    const songSelect = document.getElementById('songSelect');
    const songHint   = document.getElementById('songHint');
    const btnPlay    = document.getElementById('btnPlay');
    const scaleInput = document.getElementById('mascotScale');

    btnPlay.addEventListener('click', (e)=>{
      e.preventDefault();
      try{ sessionStorage.setItem('SL_AUTOSTART','1'); }catch{}
      location.href = 'index.html';
    });

    function supabaseUrls(){
      const s = CFG.music && CFG.music.supabase;
      if(!s || !s.enabled || !s.projectRef || !s.bucket || !Array.isArray(s.files)) return [];
      const base = `https://${s.projectRef}.supabase.co/storage/v1/object/public/${encodeURIComponent(s.bucket)}/`;
      return s.files.map(name => ({ name, url: base + encodeURIComponent(name) }));
    }
    const urls = supabaseUrls();
    if(urls.length){
      songSelect.innerHTML = urls.map(({name,url})=>`<option value="${url}">${name}</option>`).join('');
      const saved = localStorage.getItem('musicSelectedUrl');
      if(saved){
        const opt = Array.from(songSelect.options).find(o=>o.value===saved);
        if(opt) songSelect.value = saved;
      }
      songHint.textContent = 'Pick a song. Switches apply immediately if the game is open.';
      songSelect.addEventListener('change', ()=>{
        localStorage.setItem('musicSelectedUrl', songSelect.value);
        try{ localStorage.setItem('_musicChangedAt', String(Date.now())); }catch{}
      });
    }else{
      songSelect.innerHTML = '<option>(No Supabase songs configured)</option>';
      songSelect.disabled = true;
    }

    const curScale = Number.isFinite(CFG.mascot?.scale) ? CFG.mascot.scale : 1;
    scaleInput.value = curScale;
    scaleInput.addEventListener('input', ()=>{
      const v = parseFloat(scaleInput.value);
      if(Number.isFinite(v)){
        CFG.mascot.setScale?.(v);
        try { localStorage.setItem('mascotScale', String(v)); } catch {}
      }
    });
  })();
  </script>
</body>
</html>
